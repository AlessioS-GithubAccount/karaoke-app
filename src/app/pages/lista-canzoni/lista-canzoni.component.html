<table class="table table-striped">
  <thead>
    <tr>
      <th >Stato</th>
      <th>#</th>
      <th>Nome</th>
      <th>Artista</th>
      <th>Canzone</th>
      <th *ngIf="isAdmin">Tonalità</th>
      <th *ngIf="isAdmin">Note</th>
      <th>Partecipa</th>
      <th *ngIf="isAdmin">Azioni</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let canzone of canzoni; let i = index">
      <!-- Stato cantata -->
      <td *ngIf="isAdmin">
        <button (click)="toggleCantata(i)" class="btn btn-sm"
                [ngClass]="canzoni[i].cantata ? 'btn-danger' : 'btn-success'">
          {{ canzoni[i].cantata ? 'Cantata' : 'Da cantare' }}
        </button>
      </td>
      <td *ngIf="!isAdmin">
        <button class="btn btn-sm"
                [ngClass]="canzoni[i].cantata ? 'btn-danger' : 'btn-success'"
                disabled
                [style.opacity]="'1'">
          {{ canzoni[i].cantata ? 'Cantata' : 'Da cantare' }}
        </button>
      </td>

      <!-- Numero -->
      <td>{{ i + 1 }}</td>

      <!-- Nome -->
      <td *ngIf="editingIndex === i">
        <input [(ngModel)]="editedCanzone.nome" class="form-control form-control-sm" />
      </td>
      <td *ngIf="editingIndex !== i">{{ canzone.nome }}</td>

      <!-- Artista -->
      <td *ngIf="editingIndex === i">
        <input [(ngModel)]="editedCanzone.artista" class="form-control form-control-sm" />
      </td>
      <td *ngIf="editingIndex !== i">{{ canzone.artista }}</td>

      <!-- Canzone -->
      <td *ngIf="editingIndex === i">
        <input [(ngModel)]="editedCanzone.canzone" class="form-control form-control-sm" />
      </td>
      <td *ngIf="editingIndex !== i">{{ canzone.canzone }}</td>

      <!-- Tonalità -->
      <td *ngIf="isAdmin">
        <ng-container *ngIf="editingIndex === i; else tonalitaStatic">
          <input [(ngModel)]="editedCanzone.tonalita" class="form-control form-control-sm" />
        </ng-container>
        <ng-template #tonalitaStatic>{{ canzone.tonalita }}</ng-template>
      </td>

      <!-- Note -->
      <td *ngIf="isAdmin">
        <ng-container *ngIf="editingIndex === i; else noteStatic">
          <input [(ngModel)]="editedCanzone.note" class="form-control form-control-sm" />
        </ng-container>
        <ng-template #noteStatic>{{ canzone.note }}</ng-template>
      </td>

      <!-- Partecipa -->
      <td>
        <button class="btn btn-primary"
                [disabled]="canzone.partecipanti_add >= 3 || !canzone.accetta_partecipanti"
                (click)="partecipaAllaCanzone(canzone)">
          Partecipa
        </button>
        <div *ngIf="partecipazioneCompleta(canzone)" class="text-warning small mt-1">
          Raggiunto num microfoni max
        </div>
        <div *ngIf="!canzone.accetta_partecipanti" class="text-muted small mt-1">
          Partecipazione non disponibile
        </div>
      </td>

      <!-- Azioni admin -->
      <td *ngIf="isAdmin">
        <button *ngIf="editingIndex !== i" class="btn btn-sm btn-warning me-1" (click)="modifica(i)">Modifica</button>
        <button *ngIf="editingIndex === i" class="btn btn-sm btn-success me-1" (click)="salvaModifica(i)">Salva</button>
        <button *ngIf="editingIndex === i" class="btn btn-sm btn-secondary me-1" (click)="annullaModifica()">Annulla</button>
        <button class="btn btn-sm btn-danger" (click)="eliminaCanzone(canzone.id, i)">Elimina</button>
      </td>
    </tr>
  </tbody>
</table>
